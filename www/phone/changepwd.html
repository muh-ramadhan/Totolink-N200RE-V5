<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="proma" content="no-cache" />
    <meta http-equiv="cache-control" content="no cache" />
    <meta http-equiv="expires" content="0" />
    <meta
      content="width=device-width,initial-scale=1,user-scalable=no"
      name="viewport"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1"
    />
    <link rel="stylesheet" href="/static/css/phone/style.css" />
    <style>
      .group {
        float: left;
        width: 100%;
        padding: 10px 0;
      }
      .text {
        width: 98%;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script type="text/x-template" id="main">
      <div>
        <div class="toper">
          <phone-back url="/phone/tools.html" :title="lang_t('menu.tools')"></phone-back>
        </div>
        <div class="nav">{{ lang_t('menu.changeadmpwd') }}</div>
        <br><br>
        <div class="content">
          <div class="group" v-if="!globalConfig.hidePasswordInput">
            <div>{{ lang_t('changepwd.orig_pass') }}</div>
            <div><input type="text" class="text" v-model="origPass" :maxlength="32" v-pass></div>
          </div>
          <div class="group">
            <div>{{ lang_t('changepwd.new_pass') }}</div>
      	  <div><input type="text" class="text" v-model="newPass" :maxlength="32" v-pass></div>
          </div>
          <div class="group">
            <div>{{ lang_t('changepwd.confirm_pass') }}</div>
      	  <div><input type="text" class="text" v-model="confirmPass" :maxlength="32" v-pass></div>
          </div>
        </div>
        <div class="space"></div>
        <div class="footer">
      	<button class="btn" @click="applyFun">{{ lang_t('common.apply') }}</button>
        </div>
      </div>
    </script>
    <script src="/plugin/vue.js"></script>
    <script src="/plugin/jquery-3.2.1.min.js"></script>
    <script src="/static/js/config.js"></script>
    <script src="/static/js/phone_layout.js"></script>
    <script src="/static/js/common.js"></script>
    <script src="/static/js/topicurl.js"></script>
    <script>
      var cs_main = {
        template: "#main",
        data: function () {
          return {
            globalConfig: globalConfig,
            lang: $.lang,
            lang_t: lang_t,
            newPass: "",
            confirmPass: "",
            origPass: "",
            user: "",
          };
        },
        created: function () {
          var s = this;
          uiPost.getPasswordCfg(function (t) {
            s.user = t.admuser;
          });
        },
        methods: {
          applyFun: function () {
            if (!globalConfig.hidePasswordInput) {
              if ("" == this.origPass)
                return (
                  Cstool.Mark({
                    content:
                      this.lang_t("changepwd.orig_pass") +
                      this.lang_t("wan.msg1"),
                    l_text: this.lang_t("common.back"),
                  }),
                  !1
                );
              if (1 == cs.string3(this.origPass))
                return (
                  Cstool.Mark({
                    content:
                      this.lang_t("changepwd.orig_pass") +
                      this.lang_t("common.msg4"),
                    l_text: this.lang_t("common.back"),
                  }),
                  !1
                );
            }
            if ("" == this.newPass)
              return (
                Cstool.Mark({
                  content:
                    this.lang_t("changepwd.new_pass") + this.lang_t("wan.msg1"),
                  l_text: this.lang_t("common.back"),
                }),
                !1
              );
            if (1 == cs.string3(this.newPass))
              return (
                Cstool.Mark({
                  content:
                    this.lang_t("changepwd.new_pass") +
                    this.lang_t("common.msg4"),
                  l_text: this.lang_t("common.back"),
                }),
                !1
              );
            if (this.newPass != this.confirmPass)
              return (
                Cstool.Mark({
                  content: this.lang_t("changepwd.msg6"),
                  l_text: this.lang_t("common.back"),
                }),
                !1
              );
            var s = this,
              n = {};
            (n.admuser = this.user),
              (n.admpass = this.newPass),
              (n.origPass = this.origPass),
              uiPost.setPasswordCfg(n, function (t) {
                0 == t.success
                  ? Cstool.Mark({
                      content: s.lang_t("changepwd.msg2"),
                      l_text: s.lang_t("common.back"),
                    })
                  : Cstool.Mark({
                      type: "load",
                      time: 2,
                      content: s.lang_t("common.effective"),
                      success: function () {
                        Cstool.Flag({
                          content: s.lang_t("common.set_success"),
                          btnText: s.lang_t("common.back"),
                          ok: function () {
                            uiPost.logout(n, function (t) {
                              setTimeout(function () {
                                var t = location.href;
                                location.href = "http://" + t.split("/")[2];
                              }, 500);
                            });
                          },
                        });
                      },
                    });
              });
          },
        },
      };
    </script>
    <script src="/static/js/main.js"></script>
  </body>
</html>
